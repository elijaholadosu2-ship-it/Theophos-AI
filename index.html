<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theophos Hub | Advanced Tools</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --p: #6366f1; --bg: #0f172a; --c: #1e293b; --text: #f8fafc; --success: #10b981; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 500px; margin: 0 auto; }
        .tabs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 20px; background: var(--c); padding: 5px; border-radius: 12px; }
        .tab-btn { background: none; border: none; color: #94a3b8; padding: 10px 5px; cursor: pointer; font-size: 0.65rem; font-weight: bold; border-radius: 8px; }
        .tab-btn.active { background: var(--p); color: white; }
        .tool-card { display: none; background: var(--c); padding: 20px; border-radius: 20px; border: 1px solid #334155; }
        .tool-card.active { display: block; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; background: var(--p); color: white; margin-top: 10px; }
        
        /* Advanced Receipt Styling */
        #receipt-render { 
            background: white; color: black; padding: 30px; border-radius: 4px; 
            font-family: 'Courier New', monospace; display: none; text-align: left;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .receipt-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align:center; margin: 20px 0;">
        <h1 style="margin:0;">THEOPHOS HUB üõ†Ô∏è</h1>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="showTool('video')">VIDEO</button>
        <button class="tab-btn" onclick="showTool('resize')">RESIZE</button>
        <button class="tab-btn" onclick="showTool('bulk')">BULK</button>
        <button class="tab-btn" onclick="showTool('receipt')">RECEIPT</button>
    </div>

    <div id="video" class="tool-card active">
        <h3>üé• Video Downloader</h3>
        <input type="text" id="vUrl" placeholder="Paste TikTok/IG Link">
        <button class="btn" onclick="window.open('https://snaptik.app/?url='+document.getElementById('vUrl').value)">Download Now</button>
    </div>

    <div id="resize" class="tool-card">
        <h3>üñºÔ∏è Image/File Resizer</h3>
        <p style="font-size:0.7rem; opacity:0.6;">Reduces file size for easy upload.</p>
        <input type="file" id="fIn" accept="image/*">
        <button class="btn" style="background:var(--success)" onclick="processResize()">Compress & Download</button>
    </div>

    <div id="bulk" class="tool-card">
        <h3>üìá Bulk Formatter</h3>
        <textarea id="numList" rows="5" placeholder="Paste numbers here (one per line)"></textarea>
        <button class="btn" onclick="doBulk()">Download .VCF File</button>
    </div>

    <div id="receipt" class="tool-card">
        <h3>üßæ Advanced Receipt Maker</h3>
        <input type="text" id="bName" placeholder="Business Name">
        <input type="text" id="items" placeholder="Items (e.g. 2 Shoes, 1 Bag)">
        <input type="number" id="price" placeholder="Total GHS">
        <button class="btn" onclick="doReceipt()">Preview Receipt</button>
        
        <div id="receipt-render">
            <div class="receipt-header">
                <h2 id="out-b" style="margin:0;"></h2>
                <p>OFFICIAL SALES RECEIPT</p>
            </div>
            <p>Date: <span id="out-d"></span></p>
            <p>Description: <b id="out-items"></b></p>
            <hr>
            <h2 style="text-align:right;">TOTAL: GHS <span id="out-p"></span></h2>
            <p style="text-align:center; font-size:0.8rem; margin-top:20px;">~ Thank you for your patronage! ~</p>
        </div>
        <button id="downBtn" class="btn" style="background:var(--success); display:none;" onclick="downloadReceipt()">Download as Image (PNG)</button>
    </div>
</div>

<script>
    function showTool(toolId) {
        document.querySelectorAll('.tool-card').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(toolId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // FIX: Bulk Formatter Download
    function doBulk() {
        const list = document.getElementById('numList').value.split('\n');
        let vcf = "";
        list.forEach((num, i) => {
            if(num.trim()) vcf += `BEGIN:VCARD\nVERSION:3.0\nFN:Client ${i+1}\nTEL;TYPE=CELL:${num.trim()}\nEND:VCARD\n`;
        });
        const blob = new Blob([vcf], {type: "text/vcard"});
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = "contacts.vcf"; a.click();
    }

    // FIX: Image Resizer
    function processResize() {
        const file = document.getElementById('fIn').files[0];
        if(!file) return alert("Select a file!");
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (e) => {
            const img = new Image();
            img.src = e.target.result;
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width * 0.6;
                canvas.height = img.height * 0.6;
                canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
                const a = document.createElement('a');
                a.href = canvas.toDataURL('image/jpeg', 0.7);
                a.download = "resized_image.jpg"; a.click();
            };
        };
    }

    // Advanced Receipt Logic
    function doReceipt() {
        document.getElementById('out-b').innerText = document.getElementById('bName').value;
        document.getElementById('out-items').innerText = document.getElementById('items').value;
        document.getElementById('out-p').innerText = document.getElementById('price').value;
        document.getElementById('out-d').innerText = new Date().toLocaleDateString();
        document.getElementById('receipt-render').style.display = 'block';
        document.getElementById('downBtn').style.display = 'block';
    }

    function downloadReceipt() {
        html2canvas(document.querySelector("#receipt-render")).then(canvas => {
            const a = document.createElement('a');
            a.href = canvas.toDataURL("image/png");
            a.download = "receipt.png"; a.click();
        });
    }
</script>
</body>
</html>
